{
  "name": "Multi-Step Crawling with Agent Review",
  "description": "Performs multi-step web crawling followed by intelligent agent review and merging of results",
  "version": "1.0.0",
  "steps": [
    {
      "step": 1,
      "name": "Initial Site Crawl",
      "type": "tool",
      "description": "Crawl the initial site and extract relevant links",
      "tool": "web_scraper",
      "parameters": {
        "urls": ["https://example.com"],
        "selectors": {
          "css": {
            "main_content": "main, .content, article",
            "navigation": "nav a, .menu a",
            "article_links": "article a, .post a, .blog a"
          }
        },
        "extract_links": true,
        "link_filters": {
          "include_patterns": ["/blog/", "/article/", "/news/", "/post/"],
          "exclude_patterns": ["#", "javascript:", "mailto:", "tel:"],
          "max_links": 15
        },
        "rate_limit": {
          "requests_per_second": 1,
          "delay_between_requests": 1.0
        }
      },
      "output_key": "initial_crawl"
    },
    {
      "step": 2,
      "name": "Detailed Content Crawl",
      "type": "tool",
      "description": "Crawl the extracted links for detailed content",
      "tool": "web_scraper",
      "parameters": {
        "urls": "{{initial_crawl.extracted_links}}",
        "selectors": {
          "css": {
            "title": "h1, .title, .post-title, .article-title",
            "content": ".content, .post-content, .article-content, article",
            "author": ".author, .byline, .post-author",
            "date": ".date, .published-date, .post-date, time",
            "tags": ".tags a, .categories a, .post-tags a",
            "summary": ".summary, .excerpt, .post-excerpt"
          }
        },
        "extract_metadata": true,
        "rate_limit": {
          "requests_per_second": 1,
          "delay_between_requests": 2.0
        }
      },
      "output_key": "detailed_content"
    },
    {
      "step": 3,
      "name": "Data Extraction and Structuring",
      "type": "tool",
      "description": "Extract and structure the crawled content",
      "tool": "data_extractor",
      "parameters": {
        "source_data": "{{detailed_content}}",
        "extractions": [
          {
            "name": "successful_pages",
            "type": "find",
            "find_criteria": {
              "array_path": "results",
              "match_field": "success",
              "match_value": "true",
              "extract_field": "extracted_data"
            }
          },
          {
            "name": "page_urls",
            "type": "find",
            "find_criteria": {
              "array_path": "results",
              "match_field": "success",
              "match_value": "true",
              "extract_field": "url"
            }
          }
        ]
      },
      "output_key": "structured_data"
    },
    {
      "step": 4,
      "name": "Agent Review and Analysis",
      "type": "agent",
      "description": "Use AI agent to review, analyze, and merge the crawled content",
      "agent": "web_crawling_review_agent",
      "parameters": {
        "task": "Review the crawled content and provide analysis. Assess the quality, relevance, and completeness of the extracted data. Identify any gaps or areas that need additional crawling. Provide a summary of the most valuable content found.",
        "context": {
          "crawled_data": "{{structured_data}}",
          "total_pages": "{{detailed_content.total_urls}}",
          "successful_pages": "{{detailed_content.successful_scrapes}}",
          "source_url": "https://example.com"
        }
      },
      "output_key": "agent_review"
    },
    {
      "step": 5,
      "name": "Save Final Results",
      "type": "tool",
      "description": "Save the final reviewed and analyzed results",
      "tool": "file_vault",
      "parameters": {
        "action": "write",
        "filename": "crawling_review_results_{{timestamp}}.json",
        "content": "{{agent_review}}",
        "content_type": "text"
      },
      "output_key": "final_results"
    }
  ],
  "output_filters": {
    "include_keys": ["agent_review", "final_results"],
    "exclude_keys": ["initial_crawl", "detailed_content", "structured_data"]
  },
  "error_handling": {
    "continue_on_error": true,
    "max_retries": 3,
    "retry_delay": 5
  }
} 